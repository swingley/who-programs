function getColor(o){return colors[o].hex}function style(o){return{fillColor:getColor(o.properties.program_count),weight:1,opacity:1,color:"white",fillOpacity:.7}}function highlightFeature(o){var e=o.target;e.setStyle({weight:2,color:"#666",dashArray:"",fillOpacity:.7}),L.Browser.ie||L.Browser.opera||e.bringToFront(),info.update(e.feature.properties)}function resetHighlight(o){programs.resetStyle(o.target),info.update()}function zoomToFeature(o){map.fitBounds(o.target.getBounds())}function onEachFeature(o,e){e.on({mouseover:highlightFeature,mouseout:resetHighlight,click:zoomToFeature})}function showPrograms(o){o.objects.Export_Output.geometries.forEach(function(o){o.properties.program_count=o.properties.Extra_Info.split("<br>").filter(function(o){return o}).length,console.log("program count",o.properties.program_count)}),programs=new L.TopoJSON(o,{onEachFeature:onEachFeature,style:style}).addTo(map),console.log("programs",programs)}var programs,map=L.map("map").setView([30,0],2);L.esri.basemapLayer("Gray").addTo(map);var info=L.control();info.onAdd=function(){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},info.update=function(o){var e="";o&&o.hasOwnProperty("CNTRY_TERR")&&o.hasOwnProperty("Extra_Info")?(e="<h4>WHO Programs:  "+o.CNTRY_TERR+"</h4>",e+="<b>"+o.Extra_Info+"</b><br>"):e="<h4>WHO Programs:</h4>Hover over a country.",this._div.innerHTML=e},info.addTo(map);var colors=[{hex:"#19375C"},{hex:"#1072BD"},{hex:"#1EB1ED"},{hex:"#B7DDE7"},{hex:"#94CDDB"},{hex:"#96B4D6"}],legend=L.control({position:"bottomright"});legend.onAdd=function(){var o=L.DomUtil.create("div","info legend");o.innerHTML+="Count<br>";for(var e=[1,2,3,4,5],r=0;r<e.length;r++)o.innerHTML+='<i style="background:'+getColor(e[r])+'"></i> '+e[r]+"<br>";return o},legend.addTo(map),L.TopoJSON=L.GeoJSON.extend({addData:function(o){if("Topology"===o.type)for(var e in o.objects){var r=topojson.feature(o,o.objects[e]);L.GeoJSON.prototype.addData.call(this,r)}else L.GeoJSON.prototype.addData.call(this,o)}}),fetch("data/who_programs.topojson").then(function(o){return o.json()}).then(function(o){console.log("parsed json",o),showPrograms(o)})["catch"](function(o){console.log("parsing failed",o)});